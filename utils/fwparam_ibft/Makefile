#
#  Copyright (C) IBM Corporation. 2007
#  Author: Doug Maxey <dwm@austin.ibm.com>
#
#  This program is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 2 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
#  Authors: Patrick Mansfield <patmans@us.ibm.com>
#	    Mike Anderson <andmike@us.ibm.com>
#	    Doug Maxey <dwm@austin.ibm.com>
#	    "Prasanna Mumbai" <mumbai.prasanna@gmail.com>
#

PROG = fwparam_ibft
MAIN = fwparam_main.o
LIB = libfwparam.a
OBJS := fwparam_ibft.o fw_entry.o
OBJS += prom_lex.o prom_parse.tab.o fwparam_ppc.o
GENFILES := prom_lex.c prom_parse.tab.c prom_parse.tab.h
CLEANFILES = $(OBJS) $(GENFILES) *.output *~

BISONFLAGS = -d
FLEXFLAGS =  -t
# turn off #line number markers
NOL = 0
ifneq (0 ,$(NOL))
	FLEXFLAGS += -L
	BISONFLAGS +=  --no-lines
endif # NOL

OPTFLAGS ?= -O2 -g -fPIC
WARNFLAGS ?= -Wall -Wstrict-prototypes
CFLAGS += $(OPTFLAGS) $(WARNFLAGS) -I../../include

all: $(LIB) $(PROG)

$(LIB): $(OBJS)
	$(AR) rcv $(LIB) $(OBJS)

clean:
	rm -f *.o $(CLEANFILES) .depend

%.c : %.l
	flex ${FLEXFLAGS} $< | perl -pe '/define YYLMAX/ && s{8192}{2048}' >$@

%.tab.c %.tab.h: %.y
	bison  ${BISONFLAGS} $<

$(GENFILES): Makefile

$(OBJS): prom_parse.tab.h prom_parse.h fwparam_ibft.h

$(PROG): $(MAIN) $(LIB)
	gcc $(CFLAGS) -o $@ $< libfwparam.a

depend:
	gcc $(CFLAGS) -M `ls *.c` > .depend

-include .depend
